<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X Reply Generator - English & Mass Reply</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #000;
            color: #fff;
            min-height: 100vh;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            padding: 20px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(90deg, #1d9bf0, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .section {
            background: #111;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #1d9bf0;
        }

        input[type="url"], input[type="text"], textarea {
            width: 100%;
            padding: 14px;
            background: #222;
            border: 1px solid #333;
            border-radius: 12px;
            color: #fff;
            font-size: 15px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #1d9bf0;
            background: #1a1a1a;
        }

        .btn {
            padding: 14px 24px;
            background: #1d9bf0;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #1a8cd8;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background: #00ba7c;
        }

        .btn-success:hover {
            background: #00a770;
        }

        .btn-secondary {
            background: #333;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .btn-danger {
            background: #ff6b6b;
        }

        .btn-danger:hover {
            background: #ff5252;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px 0;
            color: #666;
        }

        .spinner {
            border: 3px solid #333;
            border-top: 3px solid #1d9bf0;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .reply-box {
            background: #222;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #1d9bf0;
            font-size: 16px;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .links-container {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            padding-right: 10px;
        }

        .link-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .link-item input {
            flex: 1;
            padding: 12px;
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }

        .link-number {
            min-width: 30px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .remove-link {
            background: #444;
            border: none;
            color: #fff;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-link:hover {
            background: #ff6b6b;
        }

        .controls-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .controls-row .btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            font-size: 14px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            color: #666;
            font-size: 13px;
        }

        .batch-result-item {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #333;
        }

        .batch-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 13px;
            color: #666;
        }

        .batch-reply {
            color: #fff;
            margin: 10px 0;
            line-height: 1.5;
        }

        .batch-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-size: 14px;
            font-weight: 500;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: .3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #1d9bf0;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            margin-left: 10px;
        }

        .api-status.connected {
            background: rgba(0, 186, 124, 0.2);
            color: #00ba7c;
        }

        .api-status.disconnected {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #111;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 15px 20px;
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.show {
            display: flex;
        }

        .notification.success {
            border-left: 4px solid #00ba7c;
        }

        .notification.error {
            border-left: 4px solid #ff6b6b;
        }

        .notification.info {
            border-left: 4px solid #1d9bf0;
        }

        .tab-container {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: #222;
            border: none;
            border-radius: 8px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab.active {
            background: #1d9bf0;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        footer {
            text-align: center;
            padding: 20px 0;
            color: #666;
            font-size: 13px;
            border-top: 1px solid #333;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .section {
                padding: 20px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .controls-row {
                flex-direction: column;
            }
            
            .controls-row .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>X Mass Reply Generator</h1>
            <div class="subtitle">Generate human-like English replies • Up to 20 links • AI-powered</div>
        </header>

        <div class="tab-container">
            <button class="tab active" data-tab="single">Single Link</button>
            <button class="tab" data-tab="mass">Mass Links (20)</button>
            <button class="tab" data-tab="settings">Settings & API</button>
        </div>

        <!-- Single Link Tab -->
        <div class="tab-content active" id="single-tab">
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-link"></i> Single Tweet Reply
                </div>
                <input type="url" id="single-url" 
                       placeholder="https://x.com/username/status/1234567890">
                
                <div class="controls-row">
                    <button class="btn" id="generate-single">
                        <i class="fas fa-brain"></i> Generate Reply
                    </button>
                    <button class="btn btn-secondary" id="copy-single" style="display: none;">
                        <i class="fas fa-copy"></i> Copy Reply
                    </button>
                    <button class="btn btn-success" id="reply-single" style="display: none;">
                        <i class="fab fa-twitter"></i> Reply on X
                    </button>
                </div>

                <div class="loading" id="single-loading">
                    <div class="spinner"></div>
                    <div>Analyzing tweet and generating human reply...</div>
                </div>

                <div id="single-result" style="display: none;">
                    <div class="reply-box" id="single-reply"></div>
                    <div class="stats">
                        <span id="single-words">0 words</span>
                        <span id="single-characters">0 characters</span>
                        <span id="single-time">Generated in 0s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mass Links Tab -->
        <div class="tab-content" id="mass-tab">
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-layer-group"></i> Mass Links Manager
                    <span class="api-status disconnected" id="mass-api-status">Local Mode</span>
                </div>
                
                <div class="links-container" id="links-container">
                    <!-- Links will be added here -->
                </div>
                
                <div class="controls-row">
                    <button class="btn btn-secondary" id="add-link">
                        <i class="fas fa-plus"></i> Add Link
                    </button>
                    <button class="btn btn-secondary" id="paste-links">
                        <i class="fas fa-paste"></i> Paste Multiple
                    </button>
                    <button class="btn btn-danger" id="clear-links">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                </div>
                
                <div class="controls-row">
                    <button class="btn" id="generate-all">
                        <i class="fas fa-bolt"></i> Generate All Replies
                    </button>
                    <button class="btn btn-success" id="generate-smart">
                        <i class="fas fa-robot"></i> Generate with AI
                    </button>
                </div>

                <div class="loading" id="mass-loading">
                    <div class="spinner"></div>
                    <div id="mass-loading-text">Preparing to generate replies...</div>
                </div>

                <div id="mass-results" style="display: none;">
                    <div class="controls-row">
                        <button class="btn" id="copy-all-replies">
                            <i class="fas fa-copy"></i> Copy All Replies
                        </button>
                        <button class="btn btn-secondary" id="export-json">
                            <i class="fas fa-file-export"></i> Export as JSON
                        </button>
                        <button class="btn btn-success" id="mass-reply-x">
                            <i class="fab fa-twitter"></i> Mass Reply (First 5)
                        </button>
                    </div>
                    
                    <div id="batch-results-container">
                        <!-- Batch results will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings-tab">
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-cog"></i> Settings & Configuration
                </div>
                
                <div class="settings-grid">
                    <div>
                        <div class="setting-group">
                            <label class="setting-label">
                                <i class="fas fa-key"></i> DeepSeek API Key
                            </label>
                            <input type="text" id="api-key" 
                                   placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                                   autocomplete="off">
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Get free API key from <a href="https://platform.deepseek.com" target="_blank" style="color: #1d9bf0;">DeepSeek Platform</a>
                            </div>
                            
                            <div class="controls-row" style="margin-top: 15px;">
                                <button class="btn btn-secondary" id="test-api">
                                    <i class="fas fa-vial"></i> Test Connection
                                </button>
                                <button class="btn" id="save-api">
                                    <i class="fas fa-save"></i> Save Key
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">
                                <i class="fas fa-toggle-on"></i> AI Mode
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="ai-toggle" checked>
                                <span class="slider"></span>
                            </label>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Use AI for smarter, context-aware replies
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="setting-group">
                            <label class="setting-label">
                                <i class="fas fa-edit"></i> Custom Prompt Template
                            </label>
                            <textarea id="custom-prompt" rows="8">
MAIN RULES FOR X REPLIES:
- Generate ONLY English replies
- Keep replies 8-12 words MAXIMUM
- Sound human, natural, conversational
- Use current internet slang appropriately
- Start with casual reactions (wait, dang, sheesh, fr)
- Vary sentence structure and length
- Never sound like AI or customer service
- Be authentic and organic
- Match the tweet's context and tone
- Ask relevant questions when appropriate
- Show personality and opinion
- Use abbreviations naturally (imo, fr, ngl, tbh)
- End naturally without being repetitive

TONE SETTINGS:
{context_tone}

SPECIFIC INSTRUCTIONS:
- Analyze tweet content thoroughly
- Respond to specific points mentioned
- Use relevant hashtags when appropriate
- Keep it fresh and unique every time
- No generic or template responses
- Sound like a real person scrolling X

AVOID:
- Overly formal language
- Perfect grammar always
- Repetitive phrases
- Emojis (text only)
- Long paragraphs
- Marketing/sales language
                            </textarea>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Use {context_tone} for dynamic tone insertion
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">
                        <i class="fas fa-sliders-h"></i> Reply Settings
                    </label>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div>
                            <div style="font-size: 13px; color: #ccc; margin-bottom: 5px;">Min Words</div>
                            <input type="number" id="min-words" value="8" min="5" max="15" style="width: 80px;">
                        </div>
                        <div>
                            <div style="font-size: 13px; color: #ccc; margin-bottom: 5px;">Max Words</div>
                            <input type="number" id="max-words" value="12" min="8" max="20" style="width: 80px;">
                        </div>
                        <div>
                            <div style="font-size: 13px; color: #ccc; margin-bottom: 5px;">Max Links</div>
                            <input type="number" id="max-links" value="20" min="5" max="50" style="width: 80px;">
                        </div>
                    </div>
                </div>
                
                <div class="controls-row" style="margin-top: 25px;">
                    <button class="btn" id="save-settings">
                        <i class="fas fa-save"></i> Save All Settings
                    </button>
                    <button class="btn btn-secondary" id="reset-settings">
                        <i class="fas fa-undo"></i> Reset to Default
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <div>X Mass Reply Generator v3.0 • English Only • AI Enhanced</div>
            <div style="margin-top: 5px; font-size: 12px;">All replies are 8-12 words • Context-aware • Human-like</div>
        </footer>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <div id="notification-text">Notification message here</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Single tab elements
            const singleUrlInput = document.getElementById('single-url');
            const generateSingleBtn = document.getElementById('generate-single');
            const singleLoading = document.getElementById('single-loading');
            const singleResult = document.getElementById('single-result');
            const singleReply = document.getElementById('single-reply');
            const copySingleBtn = document.getElementById('copy-single');
            const replySingleBtn = document.getElementById('reply-single');
            const singleWords = document.getElementById('single-words');
            const singleChars = document.getElementById('single-characters');
            const singleTime = document.getElementById('single-time');
            
            // Mass tab elements
            const linksContainer = document.getElementById('links-container');
            const addLinkBtn = document.getElementById('add-link');
            const pasteLinksBtn = document.getElementById('paste-links');
            const clearLinksBtn = document.getElementById('clear-links');
            const generateAllBtn = document.getElementById('generate-all');
            const generateSmartBtn = document.getElementById('generate-smart');
            const massLoading = document.getElementById('mass-loading');
            const massLoadingText = document.getElementById('mass-loading-text');
            const massResults = document.getElementById('mass-results');
            const batchResultsContainer = document.getElementById('batch-results-container');
            const copyAllRepliesBtn = document.getElementById('copy-all-replies');
            const exportJsonBtn = document.getElementById('export-json');
            const massReplyXBtn = document.getElementById('mass-reply-x');
            const massApiStatus = document.getElementById('mass-api-status');
            
            // Settings elements
            const apiKeyInput = document.getElementById('api-key');
            const testApiBtn = document.getElementById('test-api');
            const saveApiBtn = document.getElementById('save-api');
            const aiToggle = document.getElementById('ai-toggle');
            const customPrompt = document.getElementById('custom-prompt');
            const minWordsInput = document.getElementById('min-words');
            const maxWordsInput = document.getElementById('max-words');
            const maxLinksInput = document.getElementById('max-links');
            const saveSettingsBtn = document.getElementById('save-settings');
            const resetSettingsBtn = document.getElementById('reset-settings');
            
            // Notification
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            // State
            let links = [''];
            let batchResults = [];
            let settings = {
                apiKey: '',
                useAI: true,
                customPrompt: '',
                minWords: 8,
                maxWords: 12,
                maxLinks: 20,
                apiConnected: false
            };
            
            // Initialize
            loadSettings();
            renderLinks();
            updateApiStatus();
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Single tab events
            generateSingleBtn.addEventListener('click', generateSingleReply);
            copySingleBtn.addEventListener('click', () => copyToClipboard(singleReply.textContent));
            replySingleBtn.addEventListener('click', () => openTwitterReply(singleUrlInput.value, singleReply.textContent));
            singleUrlInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') generateSingleReply();
            });
            
            // Mass tab events
            addLinkBtn.addEventListener('click', addLink);
            pasteLinksBtn.addEventListener('click', pasteMultipleLinks);
            clearLinksBtn.addEventListener('click', clearLinks);
            generateAllBtn.addEventListener('click', () => generateAllReplies(false));
            generateSmartBtn.addEventListener('click', () => generateAllReplies(true));
            copyAllRepliesBtn.addEventListener('click', copyAllReplies);
            exportJsonBtn.addEventListener('click', exportAsJson);
            massReplyXBtn.addEventListener('click', massReplyOnX);
            
            // Settings events
            testApiBtn.addEventListener('click', testApiConnection);
            saveApiBtn.addEventListener('click', saveApiKey);
            saveSettingsBtn.addEventListener('click', saveAllSettings);
            resetSettingsBtn.addEventListener('click', resetSettings);
            
            // Functions
            function renderLinks() {
                linksContainer.innerHTML = '';
                const maxLinks = parseInt(maxLinksInput.value) || 20;
                
                links.forEach((link, index) => {
                    const div = document.createElement('div');
                    div.className = 'link-item';
                    div.innerHTML = `
                        <div class="link-number">${index + 1}</div>
                        <input type="url" 
                               class="link-input" 
                               placeholder="https://x.com/username/status/..."
                               value="${link}"
                               data-index="${index}"
                               ${index >= maxLinks ? 'disabled' : ''}>
                        <button class="remove-link" data-index="${index}" ${links.length <= 1 ? 'disabled' : ''}>
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    linksContainer.appendChild(div);
                });
                
                // Add event listeners
                document.querySelectorAll('.link-input').forEach(input => {
                    input.addEventListener('input', function() {
                        const index = parseInt(this.dataset.index);
                        links[index] = this.value;
                    });
                });
                
                document.querySelectorAll('.remove-link').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        removeLink(index);
                    });
                });
            }
            
            function addLink() {
                const maxLinks = parseInt(maxLinksInput.value) || 20;
                if (links.length >= maxLinks) {
                    showNotification(`Maximum ${maxLinks} links allowed`, 'error');
                    return;
                }
                links.push('');
                renderLinks();
            }
            
            function removeLink(index) {
                if (links.length <= 1) {
                    showNotification('At least 1 link required', 'error');
                    return;
                }
                links.splice(index, 1);
                renderLinks();
            }
            
            function pasteMultipleLinks() {
                const text = prompt('Paste multiple links (one per line):');
                if (!text) return;
                
                const newLinks = text.split('\n')
                    .map(link => link.trim())
                    .filter(link => link && isValidTwitterUrl(link))
                    .slice(0, parseInt(maxLinksInput.value) || 20);
                
                if (newLinks.length > 0) {
                    links = [...newLinks];
                    if (links.length < (parseInt(maxLinksInput.value) || 20)) {
                        links.push('');
                    }
                    renderLinks();
                    showNotification(`Added ${newLinks.length} links`, 'success');
                } else {
                    showNotification('No valid X/Twitter links found', 'error');
                }
            }
            
            function clearLinks() {
                if (links.length === 0 || (links.length === 1 && links[0] === '')) return;
                if (!confirm('Clear all links?')) return;
                links = [''];
                renderLinks();
                massResults.style.display = 'none';
                showNotification('All links cleared', 'info');
            }
            
            async function generateSingleReply() {
                const url = singleUrlInput.value.trim();
                if (!url || !isValidTwitterUrl(url)) {
                    showNotification('Please enter a valid X/Twitter URL', 'error');
                    return;
                }
                
                const startTime = Date.now();
                singleLoading.style.display = 'block';
                singleResult.style.display = 'none';
                
                try {
                    const reply = await generateReply(url, true);
                    const endTime = Date.now();
                    
                    singleReply.textContent = reply;
                    singleWords.textContent = `${reply.split(' ').length} words`;
                    singleChars.textContent = `${reply.length} characters`;
                    singleTime.textContent = `Generated in ${(endTime - startTime)/1000}s`;
                    
                    singleResult.style.display = 'block';
                    copySingleBtn.style.display = 'inline-flex';
                    replySingleBtn.style.display = 'inline-flex';
                    
                    singleResult.scrollIntoView({ behavior: 'smooth' });
                    showNotification('Reply generated successfully!', 'success');
                    
                } catch (error) {
                    showNotification('Error generating reply', 'error');
                    console.error(error);
                } finally {
                    singleLoading.style.display = 'none';
                }
            }
            
            async function generateAllReplies(useAI = false) {
                const validLinks = links.filter(link => link.trim() && isValidTwitterUrl(link));
                if (validLinks.length === 0) {
                    showNotification('No valid links found', 'error');
                    return;
                }
                
                massLoading.style.display = 'block';
                massLoadingText.textContent = 'Preparing to generate replies...';
                massResults.style.display = 'none';
                batchResults = [];
                
                try {
                    for (let i = 0; i < validLinks.length; i++) {
                        const link = validLinks[i];
                        massLoadingText.textContent = `Generating reply ${i + 1} of ${validLinks.length}...`;
                        
                        let reply;
                        if (useAI && settings.apiConnected && settings.useAI) {
                            reply = await generateAIReply(link);
                        } else {
                            reply = generateLocalReply(link);
                        }
                        
                        batchResults.push({
                            url: link,
                            reply: reply,
                            index: i + 1,
                            words: reply.split(' ').length,
                            source: useAI && settings.apiConnected ? 'AI' : 'Local'
                        });
                        
                        // Small delay to avoid rate limiting
                        if (useAI) await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    displayBatchResults();
                    massResults.style.display = 'block';
                    massLoading.style.display = 'none';
                    
                    showNotification(`Generated ${batchResults.length} replies successfully!`, 'success');
                    massResults.scrollIntoView({ behavior: 'smooth' });
                    
                } catch (error) {
                    massLoading.style.display = 'none';
                    showNotification('Error generating batch replies', 'error');
                    console.error(error);
                }
            }
            
            function generateLocalReply(url) {
                const context = analyzeUrlContext(url);
                const tone = context.tone || 'casual';
                
                // Enhanced English-only reply database
                const replyDatabase = {
                    'tech': [
                        "dang this tech is evolving way too fast fr",
                        "wait the implications of this are actually wild",
                        "sheesh this could legit change everything we know",
                        "lowkey concerned about where this is heading ngl",
                        "bruh we're literally living in the future now",
                        "the potential here is actually insane tbh",
                        "wonder how this plays out in real life",
                        "game changer if they actually pull this off",
                        "need to read more about this asap fr",
                        "massive if true no cap deadass"
                    ],
                    'crypto': [
                        "volatility is absolutely wild in this market rn",
                        "interesting move wonder what's really behind it",
                        "timing seems perfect for this specific play",
                        "need to research this project more imo",
                        "potential is there but risky af ngl",
                        "market sentiment shifting rapidly lately fr",
                        "curious about the actual tokenomics behind this",
                        "could be a legit game changer if right",
                        "speculation is high on this one tbh",
                        "risk reward ratio seems decent here maybe"
                    ],
                    'gaming': [
                        "no way the graphics look absolutely insane fr",
                        "need to cop this game asap no cap",
                        "game of the year contender for sure",
                        "the gameplay looks so smooth damn sheesh",
                        "hyped beyond belief for this release deadass",
                        "wonder how the story actually plays out",
                        "multiplayer gonna be absolutely wild bro fr",
                        "day one purchase no questions asked period",
                        "the details in this are crazy sheesh",
                        "can't wait to dive into this fr"
                    ],
                    'politics': [
                        "interesting take on this whole situation fr",
                        "wonder what the actual data shows tbh",
                        "timing seems a bit sus to me ngl",
                        "complex issue with many layers deadass",
                        "need more context to really understand imo",
                        "politics be wilding these days smh fr",
                        "will be following this story closely tbh",
                        "real conversation needed about this topic period",
                        "curious about the long term effects fr",
                        "many perspectives to consider here tbh"
                    ],
                    'casual': [
                        "wait this is actually interesting fr",
                        "dang never thought about it like that",
                        "sheesh that's a whole new perspective",
                        "lowkey might need to try this",
                        "bruh this hits different ngl",
                        "the more you know right haha",
                        "wonder if this applies to everyone",
                        "makes you think about things differently",
                        "interesting point never considered that",
                        "food for thought for sure fr"
                    ]
                };
                
                const category = context.category || 'casual';
                const replies = replyDatabase[category] || replyDatabase['casual'];
                let reply = replies[Math.floor(Math.random() * replies.length)];
                
                // Adjust word count
                reply = adjustWordCount(reply, settings.minWords, settings.maxWords);
                
                return reply;
            }
            
            async function generateAIReply(url) {
                if (!settings.apiKey || !settings.apiConnected) {
                    throw new Error('API not configured');
                }
                
                const context = analyzeUrlContext(url);
                const prompt = buildAIPrompt(context);
                
                try {
                    const response = await fetch('https://api.deepseek.com/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${settings.apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            max_tokens: 100,
                            temperature: 0.8,
                            frequency_penalty: 1.0
                        })
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error?.message || 'API Error');
                    }
                    
                    const data = await response.json();
                    let reply = data.choices[0].message.content.trim();
                    
                    // Clean up AI response
                    reply = reply.replace(/^["']|["']$/g, '');
                    reply = reply.replace(/^(Reply:|Response:|Here's.*?:)/i, '');
                    reply = reply.trim();
                    
                    // Ensure word count
                    reply = adjustWordCount(reply, settings.minWords, settings.maxWords);
                    
                    return reply;
                    
                } catch (error) {
                    console.error('AI Generation Error:', error);
                    throw error;
                }
            }
            
            function buildAIPrompt(context) {
                let prompt = customPrompt.value || settings.customPrompt;
                
                // Replace placeholders
                prompt = prompt.replace(/{context_tone}/g, context.tone || 'casual, conversational');
                prompt = prompt.replace(/{min_words}/g, settings.minWords);
                prompt = prompt.replace(/{max_words}/g, settings.maxWords);
                
                // Add specific context
                prompt += `\n\nSPECIFIC TWEET CONTEXT:
Category: ${context.category}
Topic: ${context.topic}
Detected Tone: ${context.tone}

Generate ONE English reply that follows ALL rules above:`;
                
                return prompt;
            }
            
            function analyzeUrlContext(url) {
                const lowerUrl = url.toLowerCase();
                
                if (lowerUrl.includes('elonmusk') || lowerUrl.includes('tesla') || lowerUrl.includes('spacex') || lowerUrl.includes('ai') || lowerUrl.includes('tech')) {
                    return {
                        category: 'tech',
                        topic: 'technology/innovation',
                        tone: 'analytical, forward-thinking'
                    };
                } else if (lowerUrl.includes('bitcoin') || lowerUrl.includes('crypto') || lowerUrl.includes('ethereum') || lowerUrl.includes('blockchain')) {
                    return {
                        category: 'crypto',
                        topic: 'cryptocurrency',
                        tone: 'speculative, market-focused'
                    };
                } else if (lowerUrl.includes('playstation') || lowerUrl.includes('xbox') || lowerUrl.includes('nintendo') || lowerUrl.includes('gaming') || lowerUrl.includes('game')) {
                    return {
                        category: 'gaming',
                        topic: 'video games',
                        tone: 'excited, enthusiastic'
                    };
                } else if (lowerUrl.includes('trump') || lowerUrl.includes('biden') || lowerUrl.includes('election') || lowerUrl.includes('politics')) {
                    return {
                        category: 'politics',
                        topic: 'government/politics',
                        tone: 'neutral, analytical'
                    };
                } else {
                    return {
                        category: 'casual',
                        topic: 'general discussion',
                        tone: 'casual, conversational'
                    };
                }
            }
            
            function adjustWordCount(text, minWords, maxWords) {
                const words = text.split(' ');
                
                if (words.length >= minWords && words.length <= maxWords) {
                    return text;
                }
                
                if (words.length < minWords) {
                    const fillers = ['fr', 'tbh', 'ngl', 'imo', 'lowkey', 'deadass', 'sheesh'];
                    const filler = fillers[Math.floor(Math.random() * fillers.length)];
                    return text + ' ' + filler;
                } else {
                    return words.slice(0, maxWords).join(' ');
                }
            }
            
            function displayBatchResults() {
                let html = '';
                
                batchResults.forEach(result => {
                    html += `
                        <div class="batch-result-item">
                            <div class="batch-header">
                                <span>Link #${result.index} • ${result.words} words • ${result.source}</span>
                                <span style="color: #666;">${result.url.substring(0, 50)}...</span>
                            </div>
                            <div class="batch-reply">${result.reply}</div>
                            <div class="batch-actions">
                                <button class="btn btn-secondary" onclick="copyToClipboard('${result.reply.replace(/'/g, "\\'")}')" style="padding: 8px 12px; font-size: 13px;">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="btn" onclick="openTwitterReply('${result.url}', '${result.reply.replace(/'/g, "\\'")}')" style="padding: 8px 12px; font-size: 13px;">
                                    <i class="fab fa-twitter"></i> Reply
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                batchResultsContainer.innerHTML = html;
            }
            
            async function testApiConnection() {
                if (!apiKeyInput.value.trim()) {
                    showNotification('Please enter API key first', 'error');
                    return;
                }
                
                testApiBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
                testApiBtn.disabled = true;
                
                try {
                    const response = await fetch('https://api.deepseek.com/models', {
                        headers: {
                            'Authorization': `Bearer ${apiKeyInput.value.trim()}`
                        }
                    });
                    
                    if (response.ok) {
                        settings.apiConnected = true;
                        settings.apiKey = apiKeyInput.value.trim();
                        updateApiStatus();
                        showNotification('API connection successful!', 'success');
                    } else {
                        throw new Error('API test failed');
                    }
                } catch (error) {
                    settings.apiConnected = false;
                    updateApiStatus();
                    showNotification('API connection failed', 'error');
                } finally {
                    testApiBtn.innerHTML = '<i class="fas fa-vial"></i> Test Connection';
                    testApiBtn.disabled = false;
                }
            }
            
            function saveApiKey() {
                settings.apiKey = apiKeyInput.value.trim();
                saveSettings();
                showNotification('API key saved', 'success');
            }
            
            function saveAllSettings() {
                settings.useAI = aiToggle.checked;
                settings.customPrompt = customPrompt.value;
                settings.minWords = parseInt(minWordsInput.value) || 8;
                settings.maxWords = parseInt(maxWordsInput.value) || 12;
                settings.maxLinks = parseInt(maxLinksInput.value) || 20;
                
                saveSettings();
                renderLinks();
                showNotification('All settings saved successfully!', 'success');
            }
            
            function resetSettings() {
                if (!confirm('Reset all settings to default?')) return;
                
                settings = {
                    apiKey: '',
                    useAI: true,
                    customPrompt: customPrompt.defaultValue,
                    minWords: 8,
                    maxWords: 12,
                    maxLinks: 20,
                    apiConnected: false
                };
                
                apiKeyInput.value = '';
                aiToggle.checked = true;
                customPrompt.value = settings.customPrompt;
                minWordsInput.value = settings.minWords;
                maxWordsInput.value = settings.maxWords;
                maxLinksInput.value = settings.maxLinks;
                
                updateApiStatus();
                showNotification('Settings reset to default', 'info');
            }
            
            function updateApiStatus() {
                if (settings.apiConnected) {
                    massApiStatus.textContent = 'AI Connected';
                    massApiStatus.className = 'api-status connected';
                } else {
                    massApiStatus.textContent = 'Local Mode';
                    massApiStatus.className = 'api-status disconnected';
                }
            }
            
            function copyAllReplies() {
                if (batchResults.length === 0) {
                    showNotification('No replies to copy', 'error');
                    return;
                }
                
                const allReplies = batchResults.map((r, i) => 
                    `Reply ${i + 1} (${r.words} words):\n${r.reply}\n`
                ).join('\n');
                
                copyToClipboard(allReplies);
            }
            
            function exportAsJson() {
                if (batchResults.length === 0) {
                    showNotification('No replies to export', 'error');
                    return;
                }
                
                const data = {
                    generatedAt: new Date().toISOString(),
                    totalReplies: batchResults.length,
                    replies: batchResults
                };
                
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `x-replies-${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('Replies exported as JSON', 'success');
            }
            
            function massReplyOnX() {
                if (batchResults.length === 0) {
                    showNotification('Generate replies first', 'error');
                    return;
                }
                
                // Open first 5 replies in Twitter
                const repliesToOpen = batchResults.slice(0, 5);
                repliesToOpen.forEach((result, index) => {
                    setTimeout(() => {
                        openTwitterReply(result.url, result.reply);
                    }, index * 1000); // Stagger opens
                });
                
                showNotification(`Opening ${repliesToOpen.length} replies in Twitter...`, 'info');
            }
            
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showNotification('Copied to clipboard!', 'success');
                    })
                    .catch(() => {
                        showNotification('Failed to copy', 'error');
                    });
            }
            
            function openTwitterReply(url, reply) {
                try {
                    const tweetId = url.split('/').pop().split('?')[0];
                    const encodedReply = encodeURIComponent(reply);
                    window.open(`https://twitter.com/intent/tweet?in_reply_to=${tweetId}&text=${encodedReply}`, '_blank');
                } catch (error) {
                    showNotification('Error opening Twitter', 'error');
                }
            }
            
            function showNotification(message, type) {
                notificationText.textContent = message;
                notification.className = `notification ${type} show`;
                
                const icon = notification.querySelector('i');
                icon.className = type === 'success' ? 'fas fa-check-circle' :
                                type === 'error' ? 'fas fa-exclamation-circle' :
                                'fas fa-info-circle';
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            function isValidTwitterUrl(url) {
                if (!url) return false;
                try {
                    const urlObj = new URL(url);
                    const host = urlObj.hostname.toLowerCase();
                    const path = urlObj.pathname;
                    return (host.includes('twitter.com') || host.includes('x.com')) &&
                           path.includes('/status/');
                } catch {
                    return false;
                }
            }
            
            function saveSettings() {
                localStorage.setItem('xMassReplySettings', JSON.stringify(settings));
            }
            
            function loadSettings() {
                try {
                    const saved = localStorage.getItem('xMassReplySettings');
                    if (saved) {
                        const loaded = JSON.parse(saved);
                        settings = { ...settings, ...loaded };
                        
                        apiKeyInput.value = settings.apiKey || '';
                        aiToggle.checked = settings.useAI !== false;
                        customPrompt.value = settings.customPrompt || customPrompt.defaultValue;
                        minWordsInput.value = settings.minWords || 8;
                        maxWordsInput.value = settings.maxWords || 12;
                        maxLinksInput.value = settings.maxLinks || 20;
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                }
            }
            
            // Global functions
            window.copyToClipboard = copyToClipboard;
            window.openTwitterReply = openTwitterReply;
            
            // Initialize with some example links
            if (links.length === 1 && links[0] === '') {
                links = [
                    'https://x.com/elonmusk/status/1234567890',
                    'https://x.com/playstation/status/2345678901',
                    'https://x.com/coinbase/status/3456789012',
                    ''
                ];
                renderLinks();
            }
        });
    </script>
</body>
</html>